<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afi's Love to Ilyan</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --gray: #e0e0e0;
            --dark-gray: #666666;
            --black: #1a1a1a;
            --rounded-sm: 12px;
            --rounded-md: 20px;
            --rounded-lg: 32px;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 2rem;
            --spacing-lg: 4rem;
            --spacing-xl: 8rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--white);
            color: var(--black);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.8s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-sm);
        }

        /* Landing Page */
        .landing-page {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--gray) 100%);
            text-align: center;
            padding: var(--spacing-sm);
            transition: opacity 1.2s ease;
        }

        .title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            font-weight: 500;
            letter-spacing: -0.02em;
            margin-bottom: var(--spacing-sm);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1.2s ease 0.3s forwards;
        }

        .subtitle {
            font-family: 'Inter', sans-serif;
            font-size: clamp(1rem, 2vw, 1.25rem);
            font-weight: 300;
            color: var(--dark-gray);
            max-width: 600px;
            margin-bottom: var(--spacing-lg);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1.2s ease 0.6s forwards;
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            font-size: 1rem;
            background-color: var(--black);
            color: var(--white);
            border: none;
            padding: 1rem 2.5rem;
            border-radius: var(--rounded-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1.2s ease 0.9s forwards;
        }

        .btn:hover {
            background-color: var(--dark-gray);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Camera Section */
        .camera-section {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-lg) var(--spacing-sm);
            min-height: 100vh;
            opacity: 0;
        }

        .camera-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 500;
            margin-bottom: var(--spacing-md);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
        }

        .camera-container {
            width: 100%;
            max-width: 800px;
            height: 60vh;
            min-height: 400px;
            background-color: var(--light-gray);
            border-radius: var(--rounded-md);
            overflow: hidden;
            margin-bottom: var(--spacing-md);
            position: relative;
            opacity: 0;
            transform: translateY(20px);
        }

        #camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror the camera preview */
        }

        .camera-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--gray) 100%);
            color: var(--dark-gray);
            text-align: center;
            padding: var(--spacing-md);
        }

        .camera-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-sm);
        }

        .capture-btn {
            position: absolute;
            bottom: var(--spacing-md);
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: var(--white);
            border: 5px solid var(--black);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .capture-btn:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .camera-controls {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .camera-error {
            color: #ff4444;
            margin-top: var(--spacing-sm);
            text-align: center;
        }

        /* Photo Display */
        .photo-section {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xl) var(--spacing-sm);
            opacity: 0;
        }

        .photo-container {
            max-width: 700px;
            width: 100%;
            margin-bottom: var(--spacing-xl);
            opacity: 0;
            transform: translateY(30px);
        }

        .photo-frame {
            width: 100%;
            border-radius: var(--rounded-md);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.5s ease;
        }

        #captured-photo {
            width: 100%;
            height: auto;
            display: block;
            filter: grayscale(100%) contrast(110%);
        }

        /* Love Meter */
        .love-meter-section {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xl) var(--spacing-sm);
            opacity: 0;
        }

        .love-meter-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 500;
            margin-bottom: var(--spacing-lg);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
        }

        .love-meter-display {
            font-family: 'Playfair Display', serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 500;
            text-align: center;
            margin-bottom: var(--spacing-sm);
            opacity: 0;
            transform: translateY(30px);
        }

        .love-meter-description {
            font-family: 'Inter', sans-serif;
            font-size: 1.25rem;
            color: var(--dark-gray);
            text-align: center;
            max-width: 600px;
            opacity: 0;
            transform: translateY(20px);
        }

        /* Poem Section */
        .poem-section {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xl) var(--spacing-sm);
            opacity: 0;
        }

        .poem-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 500;
            margin-bottom: var(--spacing-lg);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
        }

        .poem-container {
            max-width: 700px;
            width: 100%;
            opacity: 0;
            transform: translateY(30px);
        }

        .poem {
            font-family: 'Inter', sans-serif;
            font-size: 1.125rem;
            line-height: 1.8;
            color: var(--black);
            white-space: pre-line;
            text-align: center;
        }

        .poem-line {
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(10px);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-sm) var(--spacing-lg);
            color: var(--dark-gray);
            font-size: 0.9rem;
            opacity: 0;
        }

        /* Animations */
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .fade-in {
            animation: fadeIn 1.2s ease forwards;
        }

        .fade-in-up {
            animation: fadeInUp 1.2s ease forwards;
        }

        .pulse {
            animation: pulse 2s infinite ease-in-out;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .landing-page {
                padding: var(--spacing-md);
            }
            
            .camera-container {
                height: 50vh;
                min-height: 300px;
            }
            
            .capture-btn {
                width: 60px;
                height: 60px;
            }
        }

        @media (max-width: 480px) {
            .camera-container {
                height: 40vh;
            }
            
            .poem {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <section class="landing-page" id="landing-page">
        <h1 class="title">Afi's Love to Ilyan</h1>
        <p class="subtitle">A monochrome love letter captured through a single moment.</p>
        <button class="btn" id="open-camera-btn">Open Camera</button>
    </section>

    <!-- Camera Section -->
    <section class="camera-section" id="camera-section">
        <h2 class="camera-title">Capture a Moment</h2>
        <div class="camera-container">
            <div class="camera-placeholder" id="camera-placeholder">
                <div class="camera-icon">üì∑</div>
                <p>Camera will activate when you allow access</p>
                <p class="camera-error" id="camera-error" style="display: none;"></p>
            </div>
            <video id="camera-preview" autoplay playsinline style="display: none;"></video>
            <button class="capture-btn pulse" id="capture-btn" style="display: none;"></button>
        </div>
        <p class="subtitle">Capture a moment that reflects your love for Ilyan.</p>
        <div class="camera-controls" id="camera-controls" style="display: none;">
            <button class="btn" id="switch-camera-btn">Switch Camera</button>
            <button class="btn" id="retry-camera-btn">Retry Camera</button>
        </div>
    </section>

    <!-- Photo Display -->
    <section class="photo-section" id="photo-section">
        <div class="container">
            <div class="photo-container">
                <div class="photo-frame">
                    <img id="captured-photo" src="" alt="Captured moment of love">
                </div>
            </div>
        </div>
    </section>

    <!-- Love Meter -->
    <section class="love-meter-section" id="love-meter-section">
        <h2 class="love-meter-title">Love Meter</h2>
        <div class="love-meter-display" id="love-percentage">Calculating...</div>
        <p class="love-meter-description" id="love-description">Afi's love for Ilyan</p>
    </section>

    <!-- Poem Section -->
    <section class="poem-section" id="poem-section">
        <h2 class="poem-title">A Love Poem</h2>
        <div class="poem-container">
            <div class="poem" id="poem">
                <!-- Poem will be generated here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div class="container">
            <p>For Ilyan ‚Äî with infinite love from Afi</p>
            <p>This moment, captured in monochrome, is timeless.</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const landingPage = document.getElementById('landing-page');
        const cameraSection = document.getElementById('camera-section');
        const photoSection = document.getElementById('photo-section');
        const loveMeterSection = document.getElementById('love-meter-section');
        const poemSection = document.getElementById('poem-section');
        const footer = document.getElementById('footer');
        
        const openCameraBtn = document.getElementById('open-camera-btn');
        const cameraPlaceholder = document.getElementById('camera-placeholder');
        const cameraError = document.getElementById('camera-error');
        const cameraPreview = document.getElementById('camera-preview');
        const captureBtn = document.getElementById('capture-btn');
        const capturedPhoto = document.getElementById('captured-photo');
        const lovePercentage = document.getElementById('love-percentage');
        const loveDescription = document.getElementById('love-description');
        const poemContainer = document.getElementById('poem');
        const cameraControls = document.getElementById('camera-controls');
        const switchCameraBtn = document.getElementById('switch-camera-btn');
        const retryCameraBtn = document.getElementById('retry-camera-btn');

        // State
        let stream = null;
        let capturedImage = null;
        let currentFacingMode = 'user'; // 'user' for front camera, 'environment' for back camera
        let isCameraActive = false;

        // Event Listeners
        openCameraBtn.addEventListener('click', openCamera);
        captureBtn.addEventListener('click', capturePhoto);
        switchCameraBtn.addEventListener('click', switchCamera);
        retryCameraBtn.addEventListener('click', retryCamera);

        // Functions
        function openCamera() {
            // Fade out landing page
            landingPage.style.opacity = '0';
            setTimeout(() => {
                landingPage.style.display = 'none';
                cameraSection.style.display = 'flex';
                setTimeout(() => {
                    cameraSection.classList.add('fade-in');
                    
                    // Animate title
                    const cameraTitle = document.querySelector('.camera-title');
                    cameraTitle.classList.add('fade-in-up');
                    
                    // Animate container
                    const cameraContainer = document.querySelector('.camera-container');
                    cameraContainer.style.animationDelay = '0.3s';
                    cameraContainer.classList.add('fade-in-up');
                    
                    // Initialize camera
                    initializeCamera();
                }, 100);
            }, 800);
        }

        function initializeCamera() {
            cameraPlaceholder.innerHTML = `
                <div class="camera-icon">üì∑</div>
                <p>Initializing camera...</p>
                <p class="camera-error" id="camera-error" style="display: none;"></p>
            `;
            
            // Request camera access
            const constraints = {
                video: {
                    facingMode: currentFacingMode,
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                },
                audio: false
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(mediaStream) {
                    stream = mediaStream;
                    cameraPreview.srcObject = stream;
                    cameraPreview.play();
                    cameraPlaceholder.style.display = 'none';
                    cameraPreview.style.display = 'block';
                    captureBtn.style.display = 'block';
                    cameraControls.style.display = 'flex';
                    isCameraActive = true;
                    
                    // Update placeholder text
                    cameraError.textContent = '';
                    cameraError.style.display = 'none';
                })
                .catch(function(err) {
                    console.error("Camera error: ", err);
                    isCameraActive = false;
                    
                    let errorMessage = "Camera access denied or camera not available.";
                    
                    if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                        errorMessage = "No camera found on this device.";
                    } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                        errorMessage = "Camera is already in use by another application.";
                    } else if (err.name === 'OverconstrainedError' || err.name === 'ConstraintNotSatisfiedError') {
                        errorMessage = "Camera doesn't support the requested constraints.";
                    } else if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                        errorMessage = "Camera permission was denied. Please allow camera access in your browser settings.";
                    } else if (err.name === 'TypeError' || err.name === 'TypeError') {
                        errorMessage = "Camera access is not supported in this browser.";
                    }
                    
                    cameraPlaceholder.innerHTML = `
                        <div class="camera-icon">‚ùå</div>
                        <p>${errorMessage}</p>
                        <p class="camera-error">Error: ${err.name}</p>
                    `;
                    cameraControls.style.display = 'flex';
                });
        }

        function switchCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Toggle between front and back camera
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            
            cameraPlaceholder.style.display = 'flex';
            cameraPlaceholder.innerHTML = `
                <div class="camera-icon">üîÑ</div>
                <p>Switching to ${currentFacingMode === 'user' ? 'front' : 'back'} camera...</p>
            `;
            cameraPreview.style.display = 'none';
            captureBtn.style.display = 'none';
            
            setTimeout(() => {
                initializeCamera();
            }, 500);
        }

        function retryCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            cameraPlaceholder.style.display = 'flex';
            cameraPlaceholder.innerHTML = `
                <div class="camera-icon">üîÑ</div>
                <p>Retrying camera access...</p>
            `;
            cameraPreview.style.display = 'none';
            captureBtn.style.display = 'none';
            
            setTimeout(() => {
                initializeCamera();
            }, 500);
        }

        function capturePhoto() {
            if (!isCameraActive) {
                alert("Camera is not active. Please check camera access.");
                return;
            }
            
            // Stop pulsing animation
            captureBtn.classList.remove('pulse');
            
            // Create canvas and capture photo
            const canvas = document.createElement('canvas');
            canvas.width = cameraPreview.videoWidth;
            canvas.height = cameraPreview.videoHeight;
            const ctx = canvas.getContext('2d');
            
            // Flip the image horizontally if using front camera
            if (currentFacingMode === 'user') {
                ctx.translate(canvas.width, 0);
                ctx.scale(-1, 1);
            }
            
            ctx.drawImage(cameraPreview, 0, 0, canvas.width, canvas.height);
            
            // Apply grayscale filter
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = avg;     // red
                data[i + 1] = avg; // green
                data[i + 2] = avg; // blue
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            capturedImage = canvas.toDataURL('image/png');
            capturedPhoto.src = capturedImage;
            
            // Stop camera stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                isCameraActive = false;
            }
            
            // Transition to photo display
            setTimeout(() => {
                cameraSection.style.opacity = '0';
                setTimeout(() => {
                    cameraSection.style.display = 'none';
                    photoSection.style.display = 'flex';
                    setTimeout(() => {
                        photoSection.classList.add('fade-in');
                        
                        // Animate photo container
                        const photoContainer = document.querySelector('.photo-container');
                        photoContainer.style.animationDelay = '0.3s';
                        photoContainer.classList.add('fade-in-up');
                        
                        // Show love meter after delay
                        setTimeout(showLoveMeter, 2000);
                    }, 100);
                }, 800);
            }, 500);
        }

        function showLoveMeter() {
            // Fade out photo section
            photoSection.style.opacity = '0';
            setTimeout(() => {
                photoSection.style.display = 'none';
                loveMeterSection.style.display = 'flex';
                setTimeout(() => {
                    loveMeterSection.classList.add('fade-in');
                    
                    // Animate title
                    const loveMeterTitle = document.querySelector('.love-meter-title');
                    loveMeterTitle.style.animationDelay = '0.3s';
                    loveMeterTitle.classList.add('fade-in-up');
                    
                    // Generate random love percentage
                    const loveTypes = [
                        { percentage: "100%", description: "Pure and Complete" },
                        { percentage: "250%", description: "Beyond Expectation" },
                        { percentage: "367%", description: "Growing Every Day" },
                        { percentage: "500%", description: "Limitless and True" },
                        { percentage: "742%", description: "Transcending Distance" },
                        { percentage: "842%", description: "Infinite in Dimension" },
                        { percentage: "1000%", description: "Overflowing Beyond Reason" },
                        { percentage: "‚àû", description: "Beyond All Measures" }
                    ];
                    
                    const randomType = loveTypes[Math.floor(Math.random() * loveTypes.length)];
                    
                    // Animate love percentage display
                    setTimeout(() => {
                        lovePercentage.textContent = `Love Percentage: ${randomType.percentage}`;
                        lovePercentage.style.animationDelay = '0.6s';
                        lovePercentage.classList.add('fade-in-up');
                        
                        // Animate description
                        setTimeout(() => {
                            loveDescription.textContent = randomType.description;
                            loveDescription.style.animationDelay = '0.9s';
                            loveDescription.classList.add('fade-in-up');
                            
                            // Show poem after delay
                            setTimeout(showPoem, 3000);
                        }, 600);
                    }, 300);
                }, 100);
            }, 800);
        }

        function showPoem() {
            // Fade out love meter
            loveMeterSection.style.opacity = '0';
            setTimeout(() => {
                loveMeterSection.style.display = 'none';
                poemSection.style.display = 'flex';
                footer.style.display = 'block';
                
                setTimeout(() => {
                    poemSection.classList.add('fade-in');
                    footer.classList.add('fade-in');
                    
                    // Animate title
                    const poemTitle = document.querySelector('.poem-title');
                    poemTitle.style.animationDelay = '0.3s';
                    poemTitle.classList.add('fade-in-up');
                    
                    // Generate and display poem
                    const poem = generatePoem();
                    poemContainer.innerHTML = poem;
                    
                    // Animate poem lines
                    setTimeout(() => {
                        const poemLines = document.querySelectorAll('.poem-line');
                        poemLines.forEach((line, index) => {
                            line.style.animationDelay = `${0.6 + (index * 0.1)}s`;
                            line.classList.add('fade-in-up');
                        });
                        
                        // Animate poem container
                        const poemContainerEl = document.querySelector('.poem-container');
                        poemContainerEl.style.animationDelay = '0.3s';
                        poemContainerEl.classList.add('fade-in-up');
                    }, 300);
                }, 100);
            }, 800);
        }

        function generatePoem() {
            const poemLines = [
                "In the silence between our miles, your name folds light into my days,",
                "And every shadow learns the shape of your tenderness.",
                "",
                "I trace the contours of your voice in the quiet hours,",
                "A map of belonging written in the language of breath.",
                "The distance between us is only geography‚Äî",
                "My heart knows no borders when it comes to you.",
                "",
                "When I think of you, time softens into something gentle,",
                "A slow river carrying the memory of your smile.",
                "I collect these moments like precious stones,",
                "Each one a testament to a love that needs no witness.",
                "",
                "There is a quiet certainty in this devotion,",
                "A truth that hums beneath the noise of the world.",
                "It is the steady rhythm of my pulse saying your name,",
                "The invisible thread that connects my soul to yours.",
                "",
                "I love you not in grand declarations,",
                "But in the quiet space between thoughts,",
                "In the gentle pull of gravity that always leads me back to you,",
                "In the way my entire being sighs in recognition of yours.",
                "",
                "This love is not a temporary shelter,",
                "But the very architecture of my existence.",
                "It is the first and last thought of every day,",
                "The infinite equation where you are always the answer.",
                "",
                "For Ilyan‚Äîwith a love that exists beyond measure,",
                "Beyond time, beyond reason, beyond every horizon.",
                "Afi"
            ];
            
            return poemLines.map(line => 
                line ? `<div class="poem-line">${line}</div>` : `<div style="height: 1.5rem;"></div>`
            ).join('');
        }

        // Clean up camera stream when leaving page
        window.addEventListener('beforeunload', function() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
